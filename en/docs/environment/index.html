<!DOCTYPE HTML> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width"> <title>VRaptor 4 - Environment</title> <link rel="shortcut icon" href="../../../img/favicon.png"> <link rel="stylesheet" href="/css/style.min.css"/> <meta name="generator" content="nanoc 3.6.7"> </head> <body> <header class="container"> <h1 class="logo"><a class="logo-link" href="../.."> <img src="../../../img/logo.png" alt="VRaptor"> </a></h1> <div class="header-links"> <ul class="community"> <li><a href="https://groups.google.com/forum/?hl=en#!forum/vraptor4" target="_blank">Google Groups</a></li> <li><a href="https://github.com/caelum/vraptor4/" target="_blank">GitHub</a></li> <li><a href="http://questions.vraptor.org" target="_blank">VRaptor Questions</a></li> </ul> <ul class="site-languages"> <li> <a class="site-language flag flag-en " title="en" href="../.."> EN </a> </li> <li> <a class="site-language flag flag-pt not-selected" title="pt" href="../../../pt"> PT </a> </li> </ul> <a href="../../search/" class="site-search-link">Go to search page</a> <form action="/en/search/" method="get" class="site-search-form"> <input type="search" name="q"> <button type="submit">Search</button> </form> </div> </header> <input type="checkbox" id="nav-visibility"> <label for="nav-visibility" class="nav-toggle">Menu</label> <nav class="main-nav"> <ul> <li><a href="../../download">Download</a></li> <li><a href="../one-minute-guide/">Documentation</a></li> <li><a href="../../cookbook/accepting-urls-ending-with-a-slash">Cookbook</a></li> <li><a href="https://github.com/caelum/vraptor4/releases" target="_blank">Changelog</a></li> <li><a href="https://github.com/caelum/vraptor4/milestones" target="_blank">Roadmap</a></li> <li><a href="../../../javadoc">Javadoc</a></li> </ul> </nav> <nav class="doc-nav container"> <h1>Documentation</h1> <ul> <li><a href="../one-minute-guide">One minute guide</a></li> <li><a href="../ten-minute-guide">Ten minute guide</a></li> <li><a href="../controllers-rest">REST Controllers</a></li> <li><a href="../components">Components</a></li> <li><a href="../converters">Converters</a></li> <li><a href="../validation">Validation</a></li> <li><a href="../interceptors">Interceptors</a></li> <li><a href="../events">Events</a></li> <li><a href="../view-and-ajax">View and Ajax</a></li> <li><a href="../download-and-upload">Download and Upload</a></li> <li><a href=".">Environment</a></li> <li><a href="../plugins">Plugins</a></li> <li><a href="../dependencies-and-prerequisites">Dependencies and prerequisites</a></li> <li><a href="../testing-components-and-controllers">Testing Components and Controllers</a></li> <li><a href="../migrating-vraptor3-project">Migrating from VRaptor 3</a></li> <li><a href="../contributing-to-vraptor">Contributing to VRaptor</a></li> <li><a href="../articles-and-presentations">Articles and Presentations</a></li> </ul> </nav> <main class="container doc-container"> <h1 id="working-with-environments">Working with environments</h1> <p>Environment is a VRaptor’s feature that allow you to define different components and settings based on the environment like: production, testing, development, and so on.</p> <p>You can, for example, deactivate the e-mail service in the development environment and enable only in production.</p> <h2 id="how-to-configure">How to configure</h2> <p>There are 3 ways to configure your environment. The first way is adding the lines below in your <code>web.xml</code>. As example, you can configure the environment name as <code>PRODUCTION</code>:</p> <pre><code class="language-xml"><span class="nt">&lt;context-param&gt;</span>
    <span class="nt">&lt;param-name&gt;</span>br.com.caelum.vraptor.environment<span class="nt">&lt;/param-name&gt;</span>
    <span class="nt">&lt;param-value&gt;</span>PRODUCTION<span class="nt">&lt;/param-value&gt;</span>
<span class="nt">&lt;/context-param&gt;</span></code></pre> <p>The second way is adding a JVM property. For this you can start your Application Server or Servlet Container with this JVM parameter:</p> <pre><code class="language-properties"><span class="na">-Dbr.com.caelum.vraptor.environment</span><span class="o">=</span><span class="s">PRODUCTION</span></code></pre> <p>And the third option is setting an environment variable under your Operating System, simple adding the <code>VRAPTOR_ENV</code> variable.</p> <p>Windows example:</p> <pre><code>set VRAPTOR_ENV=PRODUCTION
</code></pre> <p>Unix example:</p> <pre><code>export VRAPTOR_ENV=PRODUCTION
</code></pre> <p><strong>Note:</strong> The environment variable of Operating System have more priority than JVM properties, that have more priority than <code>web.xml</code> configuration. So, as example, if your application uses both <code>web.xml</code> and JVM properties, the configuration over <code>web.xml</code> will ignored.</p> <h2 id="setting-an-environment-properties">Setting an environment properties</h2> <p>You only need to create a properties file with the name of your environment in your classpath. As example, to set the properties for <code>PRODUCTION</code> environment you only need to create a file called <code>production.properties</code> like this:</p> <pre><code class="language-properties"><span class="na">test_environment</span><span class="o">=</span><span class="s">false</span>
<span class="na">email</span><span class="o">=</span><span class="s">production.mail@mail.com</span></code></pre> <p>If you have a common properties for other environments you can create a file called <code>environment.properties</code> with these common properties. So VRaptor will ask for properties first in the environment file, and if not found, will ask in the <code>environment.properties</code> file.</p> <p>You can also override properties using System Properties. Properties defined by System Properties will override any other definitions. <strong>Note:</strong> You can only use System Properties to override existing properties in property files and not to define a new one.</p> <p>Considering that you have the environment.properties below: ~~~ #!properties my.prop hello ~~~ </p> <p>You can override the existing my.prop with a System Property like this: ~~~ #!java System.setProperty(“my.prop”, “bye”); environment.get(“my.prop”); //bye ~~~ </p> <p>If the key doesn’t exists in properties file, get method will throw a NoSuchElementException.</p> <h2 id="getting-environment-properties-in-your-code">Getting environment properties in your code</h2> <p>There are two methods to get the properties: <code>get</code> and <code>getOrDefault</code>. The first method returns the property value if the value exists, or an <code>MissingResourceException</code> if not found. And with <code>getOrDefault</code> you can return a default value if the key is not found. Take a look in the code below:</p> <pre><code class="language-java"><span class="nd">@Controller</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyController</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">final</span> <span class="n">Environment</span> <span class="n">environment</span><span class="o">;</span>

    <span class="kd">private</span> <span class="kd">final</span> <span class="n">MailSender</span> <span class="n">sender</span><span class="o">;</span>

    <span class="cm">/**</span>
<span class="cm">     * @deprecated CDI eyes only</span>
<span class="cm">     */</span>
    <span class="kd">protected</span> <span class="nf">MyController</span><span class="o">(){</span>
        <span class="k">this</span><span class="o">(</span><span class="kc">null</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Inject</span>
    <span class="kd">public</span> <span class="nf">MyController</span><span class="o">(</span><span class="n">Environment</span> <span class="n">environment</span><span class="o">,</span> <span class="n">MailSender</span> <span class="n">sender</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">environment</span> <span class="o">=</span> <span class="n">environment</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">sender</span> <span class="o">=</span> <span class="n">sender</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">sendMail</span><span class="o">(</span><span class="n">String</span> <span class="n">email</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span><span class="o">(</span><span class="n">environment</span><span class="o">.</span><span class="na">isDevelopment</span><span class="o">())</span> <span class="o">{</span>
            <span class="n">sender</span><span class="o">.</span><span class="na">sendMailTo</span><span class="o">(</span><span class="n">environment</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"email"</span><span class="o">));</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
            <span class="n">sender</span><span class="o">.</span><span class="na">sendMailTo</span><span class="o">(</span><span class="n">email</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre> <p>In the code above, <code>environment.get("email")</code> we will get the property <code>email</code>. But if this property is not always present, we can use the <code>getOrDefault</code> method to return a default value.</p> <pre><code class="language-java"><span class="kd">public</span> <span class="kt">void</span> <span class="nf">sendMail</span><span class="o">(</span><span class="n">String</span> <span class="n">email</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span><span class="o">(</span><span class="n">environment</span><span class="o">.</span><span class="na">isDevelopment</span><span class="o">())</span> <span class="o">{</span>
            <span class="n">sender</span><span class="o">.</span><span class="na">sendMailTo</span><span class="o">(</span><span class="n">environment</span><span class="o">.</span><span class="na">getOrDefault</span><span class="o">(</span><span class="s">"email"</span><span class="o">),</span> <span class="s">"noreply@vraptor.org"</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
            <span class="n">sender</span><span class="o">.</span><span class="na">sendMailTo</span><span class="o">(</span><span class="n">email</span><span class="o">);</span>
        <span class="o">}</span>
<span class="o">}</span></code></pre> <h2 id="getting-environment-properties-in-your-jsp">Getting environment properties in your JSP</h2> <pre><code class="language-jsp"><span class="nt">&lt;c:if</span> <span class="na">test=</span><span class="s">"${environment.isTest()}"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;p&gt;</span>You are now in the test environment. Your actions here will not affect the system.<span class="nt">&lt;/p&gt;</span>
<span class="nt">&lt;/c:if&gt;</span>

Send an e-mail to: ${environment.get('email')}</code></pre> <h2 id="accessing-configuration-files-according-to-the-environment">Accessing configuration files according to the environment</h2> <p>If you need to access a file in a different setting for your libraries according to your environment, you can also use the environemnt. Just put, for example, your <code>hibernate.cfg.xml</code> under directories located with the name of your environment: <em>development</em> and <em>production</em> (for example). <code>Environment.getResource (...)</code> returns the resource according to your current environment:</p> <pre><code class="language-java"><span class="n">cfg</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AnnotationConfiguration</span><span class="o">();</span>
<span class="n">cfg</span><span class="o">.</span><span class="na">configure</span><span class="o">(</span><span class="n">environment</span><span class="o">.</span><span class="na">getResource</span><span class="o">(</span><span class="s">"/hibernate.cfg.xml"</span><span class="o">));</span></code></pre> <p>To keep compatibility with applications that don’t not environment, if the file isn’t found in the directory with the name of the environment, it will be loaded from classpath.</p> <h2 id="injecting-the-value-of-your-configuration-programmatically">Injecting the value of your configuration programmatically</h2> <p>You can also inject your settings programmatically using <code>@Property</code> annotation, like:</p> <pre><code class="language-java"><span class="nd">@Controller</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyController</span> <span class="o">{</span>

    <span class="nd">@Inject</span>
    <span class="nd">@Property</span><span class="o">(</span><span class="s">"email"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">email</span><span class="o">;</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">sendMail</span><span class="o">(</span><span class="n">String</span> <span class="n">email</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">sender</span><span class="o">.</span><span class="na">sendMailTo</span><span class="o">(</span><span class="n">email</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre> <p>If your environment is <code>DEVELOPMENT</code>, the value for key <code>email</code> will be loaded using <code>development.properties</code>. And if your environment is <code>PRODUCTION</code> the value will be loaded from <code>production.properties</code>. This feature allow you to keep away from conditional statements like: <code>if (environment.isDevelopment ()) {...}</code> in your code.</p> <p>And if the field name is the same from the key, you can use only the <code>@Property</code> annotation without define a value, like this:</p> <pre><code class="language-java"><span class="nd">@Controller</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyController</span> <span class="o">{</span>

    <span class="nd">@Inject</span>
    <span class="nd">@Property</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">email</span><span class="o">;</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">sendMail</span><span class="o">(</span><span class="n">String</span> <span class="n">email</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">sender</span><span class="o">.</span><span class="na">sendMailTo</span><span class="o">(</span><span class="n">email</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre> <p>You can also set a default value for this property:</p> <pre><code class="language-java"><span class="nd">@Inject</span>
<span class="nd">@Property</span><span class="o">(</span><span class="n">defaultValue</span> <span class="o">=</span> <span class="s">"config.properties"</span><span class="o">)</span>
<span class="kd">private</span> <span class="n">String</span> <span class="n">fileName</span><span class="o">;</span></code></pre> </main> <script src="../../../js/search-en.js"></script> <script src="/js/headers.min.js"></script> </body> </html>